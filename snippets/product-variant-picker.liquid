{% assign option_index = forloop.index0 %}

{% for value in option.values %}
  {% assign matched_variant = product.variants | where: 'option' | slice: option_index | where: value | first %}
  {% assign image_url = matched_variant.featured_image | img_url: '100x100' %}

  <label class="variant-picker__item variant-picker__item--image">
    <input
      type="radio"
      name="options[{{ option.name | escape }}]"
      value="{{ value | escape }}"
      {% if option.selected_value == value %}checked{% endif %}
      form="{{ product_form_id }}"
    >
    {% if matched_variant and matched_variant.featured_image %}
      <img src="{{ image_url }}" alt="{{ value | escape }}" loading="lazy" />
    {% else %}
      <span>{{ value }}</span>
    {% endif %}
  </label>
{% endfor %}
